<!DOCTYPE html><html lang="zh-CN"><head>
    <meta charset="utf-8">
    <meta name="Y_z00" content="å­¦ä¹ å’Œè®°å½•ä½¿ç”¨">
    <link rel="icon" href="/images/icons/icon.png" type="images/icons">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.25/dist/katex.min.css" integrity="sha384-WcoG4HRXMzYzfCgiyfrySxx90XSl2rxY5mnVY5TwtWE6KLrArNKn0T/mOgNL0Mmi" crossorigin="anonymous">
    <script defer="" src="https://cdn.jsdelivr.net/npm/katex@0.16.25/dist/katex.min.js" integrity="sha384-J+9dG2KMoiR9hqcFao0IBLwxt6zpcyN68IgwzsCSkbreXUjmNVRhPFTssqdSGjwQ" crossorigin="anonymous"></script>
    <script defer="" src="https://cdn.jsdelivr.net/npm/katex@0.16.25/dist/contrib/auto-render.min.js" integrity="sha384-hCXGrW6PitJEwbkoStFjeJxv+fSOOQKOPbJxSfM6G5sWZjAyWhXiTIIAmQqnlLlh" crossorigin="anonymous"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            renderMathInElement(document.body, {
                delimiters: [
                    { left: '$$', right: '$$', display: true },
                    { left: '$', right: '$', display: false },
                    { left: '\\(', right: '\\)', display: false },
                    { left: '\\[', right: '\\]', display: true }
                ],
                throwOnError: true
            });
        });
    </script>

    <link rel="stylesheet" href="/fonts/stylesheet.css">
    <link rel="stylesheet" href="/docs/docs_m.css">

    <link rel="stylesheet" href="/highlights/styles/gradient-dark.min.css">

    <link rel="stylesheet" href="/fonts/stylesheet.css">
    <style>
        a:link {
            color: #cba700;
        }

        a:visited {
            color: #00a6ff;
        }
    </style>
<title>sitedoc_markdownnewrule</title></head>

<body>
    <body-sidebar id="body-sidebar-1-id" class="body-sidebar-1">
        <div class="body-sidebar-header">
            <div id="body-sidebar-icons-1" class="body-sidebar-icons"></div>
            <div id="body-sidebar-icons-2" class="body-sidebar-icons"></div>
            <divv>æ–‡ä»¶èµ„æº</divv>
            <!-- onclick="clicked_0()" in source\component_html\sidebar_lis_switch.js -->
            <div id="header-m-icon_1" class="header-m-icon" onclick="clicked_1()"></div>
        </div>
        <div id="body-sidebar-title-1" class="body-sidebar-title">
            <div id="body-sidebar-icons-3" class="body-sidebar-icons"></div>
            <div class="body-sidebar-lis-m-text">æ–‡ä»¶æ ‘</div>
        </div>
    </body-sidebar>
    <viewer id="body-viewer-1" class="body-viewer">
        <!-- i use javascript to generate a element in list you click -->
        <iframe id="body-viewer-iframe-1" class="body-viewer-iframe" src="/docs" title="iframe-1"></iframe>
        <div id="body-viewer-scrollbar_0" class="body-viewer-scrollbar"></div>
        <div id="body-viewer-switch_0" class="body-viewer-switch" onclick="close_0()"></div>
    </viewer>

    <viewer id="body-viewer-2" class="body-viewer">
        <innerbody id="body_0">
            <div id="tag_0">
                <img title="icon" src="/images/icons/icon.png" width="100px" id="img_0">
                
                <div id="tag_0_0">
                    <p><a title="badges" href=""><img title="badge" src="https://img.shields.io/badge/build-passing-blue.svg?style=flat-square" alt=""></a>
                        <a href=""><img title="badge" src="https://img.shields.io/github/stars/Yz0012/Yz0012.github.io?style=flat-square" alt="GitHub Repo stars"></a>
                    </p>
                <a id="html_url_0" href="./sitedoc_markdownnewrule.html">o(*â‰§â–½â‰¦)ãƒ„â”â”â”“æœ¬æ–‡é“¾æ¥:./sitedoc_markdownnewrule.html</a><div id="timeDataWrap_0"><div style="background-image: url(&quot;/images/svgicons/clock-svgrepo-com.svg&quot;); width: 2rem; height: 2rem; background-repeat: no-repeat; background-size: cover;" id="timeData_svg_0"></div><div id="timeData_UTC">ç¼–è¯‘æ—¶é—´ : Mon, 08 Dec 2025 14:19:00 GMT</div></div><div id="typeWrap_0"><div style="background-image: url(&quot;/images/svgicons/price-tag-svgrepo-com.svg&quot;); width: 2rem; height: 2rem; background-repeat: no-repeat; background-size: cover;" id="type_svg_0"></div><div id="type_data_0">æ‰€å±ç±»å‹ : sitedoc</div></div></div>
            </div>

            <p align="center" id="tag_1">
                ç«™ç‚¹ä¸­æ‰€æœ‰æ–‡æ¡£(/docs/truedocs/å†… .md .pdf æ–‡ä»¶)å‡é‡‡ç”¨<a href="https://creativecommons.org/licenses/by-nc/4.0/legalcode.txt">CC
                    BY-NC-SA 4.0 è®¸å¯</a></p>
        <div id="wrap_0"><h2>Markdown-it æ–°å¢è§£æè§„åˆ™</h2>
<p>ä¸ºäº†ç»™markdown-itæ–°å¢è§„åˆ™ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£<a href="https://markdown-it.github.io/markdown-it/#Ruler">markdown-itæ–‡æ¡£</a>å†…çš„Rulerç±»å’Œå…¶å±æ€§</p>
<p>è¿™é‡Œçš„<s>ç»“æœå°è¯•ä½¿ç”¨<code>push</code>å±æ€§</s>ä¸ºmarkdown-itæ–°å¢ä¸€ä¸ªæ ¹æ®<code>!@</code>åŒ…è£¹è€Œè§£æä¸º<code>&lt;pre&gt;&lt;code&gt;&lt;/code&gt;&lt;/pre&gt;</code>
çš„è§„åˆ™</p>
<p>ä¸è¿‡åœ¨æ­¤ä¹‹å‰å…ˆå°è¯•ä½¿ç”¨å—çº§å…ƒç´ <code>before</code>å±æ€§ï¼Œä»è€Œä½¿replaceå‡½æ•°èƒ½æ­£å¸¸æ‰§è¡Œ</p>
<p>æ ¹æ®å®˜æ–¹çš„ç¤ºä¾‹</p>
<pre><code>
var md = require('markdown-it')();

md.block.ruler.before('paragraph', 'my_rule', function replace(state) {
  //...
});
</code>
</pre>
<p>æˆ‘ä»¬å¯ä»¥å†™ä¸€ä¸ªç›¸åŒçš„å½¢å¼çš„ï¼Œå°è¯•è¾“å‡º<code>state.eMarks</code></p>
<pre><code>
md.block.ruler.before('paragraph', '!@codeblock_0', function replace(state) {
  console.log(state.eMarks);
});
</code>
</pre>
<h3>å‚æ•°åˆ†æ</h3>
<p>æ ¹æ®è¾“å‡ºç»“æœæˆ–è€…æ ¹æ®æç¤ºï¼Œæˆ‘ä»¬å¯ä»¥å¾—çŸ¥<code>state.eMarks</code>ä¸­çš„æ¯ä¸ªæ•°å­—æ˜¯æŒ‡å®ƒæ‰€åœ¨è¡Œæœ€åä¸€ä¸ªå­—ç¬¦ä¸²(åŒ…æ‹¬æ¢è¡Œ)ä¹‹å‰æ‰€å…·æœ‰çš„å­—ç¬¦ä¸²æ€»æ•°</p>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜å¯ä»¥è¾“å‡º<code>state</code>çš„å…¶ä½™å±æ€§ï¼Œè§‚å¯Ÿå®ƒæ‰€å…·æœ‰çš„æ„ä¹‰ï¼Œæ¯”å¦‚</p>
<p><code>state.bMarks</code>ä¸­æ¯ä¸ªæ•°å­—æŒ‡å®ƒæ‰€åœ¨è¡Œç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²(åŒ…æ‹¬æ¢è¡Œ)ä¹‹å‰æ‰€å…·æœ‰çš„å­—ç¬¦ä¸²æ€»æ•°</p>
<p><code>state.tShift</code>ä¸­æ¯ä¸ªæ•°å­—æŒ‡å®ƒæ‰€åœ¨è¡Œçš„ç¼©è¿›çš„ç©ºæ ¼æ•°</p>
<p>ç°åœ¨æˆ‘ä»¬å·²ç»å¤§è‡´æ˜ç¡®äº†å®ƒå…¶ä¸­çš„æ„ä¹‰ï¼Œä½†åŒæ—¶ä¹Ÿæ˜ç™½å®ƒè¾“å‡ºçš„æ˜¯ä¸€ä¸ªäºŒç»´æ•°ç»„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è¡Œæ•°æ¥è¡¨ç¤ºæ•°å­—æ‰€åœ¨çš„è¡Œæ•°ä»¥å®ç°ç²¾ç¡®çš„å®šä½ï¼Œè€Œè¿™ä¸ªè¡Œæ•°å¯ä»¥åœ¨replaceå‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°(startLine)å’Œç¬¬ä¸‰ä¸ªå‚æ•°(endLine)è·å–ï¼Œç…§è‘«èŠ¦ç”»ç“¢åœ°è¾“å‡ºå‚æ•°è§‚å¯Ÿæ„ä¹‰</p>
<p><code>startLine</code>ä¸­æ¯ä¸ªæ•°å­—æŒ‡æ‰€åœ¨è¡Œ</p>
<p><code>endLine</code>ä¸­æ¯ä¸ªæ•°å­—ä¹Ÿè¡¨ç¤ºæ‰€åœ¨è¡Œ</p>
<p>æ¯è¡ŒæŒ‡çš„æ˜¯æ²¡æœ‰æ¢è¡Œçš„ä¸€è¡Œ</p>
<p>æ¥ä¸‹æ¥é€šè¿‡è¿™äº›å‚æ•°è·å–<code>!@</code>æ‰€åŒ…è£¹çš„å­—ç¬¦ä¸²ï¼Œè¿”å›ç›¸åº”çš„htmlæ•°æ®</p>
<h3>è·å–åŒ¹é…çš„å­—ç¬¦ä½ç½®</h3>
<p>æ ¹æ®ä¸Šè¿°åˆ†æï¼Œè·å–æ¯è¡Œåˆå§‹ä½ç½®å’Œç»“æŸä½ç½®</p>
<pre><code>
let pos = state.bMarks[startLine] + state.tShift[startLine];
let endLine_0 = state.eMarks[startLine] + state.tShift[startLine];
</code>
</pre>
<p>åˆ©ç”¨<code>substring</code>æˆ‘ä»¬å¯ä»¥è·å–æ¯è¡Œä¸­çš„å­—ç¬¦ä¸²ï¼Œä¸è¿‡åœ¨è¿™ä¹‹å‰è¦æ‰¾åˆ°æˆ‘ä»¬æ‰€æŒ‡å®šçš„æ ‡ç­¾<code>!@</code>ï¼Œå› ä¸ºä½¿ç”¨çš„æ˜¯å—çº§å…ƒç´ ï¼Œæ‰€ä»¥è¦ä½¿ç”¨<code>charCodeAt</code>è·å–è¡Œå¼€å¤´å¤„ä¸¤ä¸ªå­—ç¬¦çš„åå…­è¿›åˆ¶ASCIIå€¼ï¼Œå¹¶ä¸<code>!@</code>çš„åå…­è¿›åˆ¶ASCIIå€¼è¿›è¡Œæ¯”è¾ƒï¼Œè¿™æ ·ä¾¿å¯ä»¥å»é™¤æ— å…³è¡Œ</p>
<p>å°†<code>!</code>å’Œ<code>@</code>çš„HEX ASCIIè½¬æ¢æˆStringç±»å‹è¿›è¡Œç›¸åŠ ç„¶åå†æ¯”è¾ƒï¼Œé˜²æ­¢æ•°å­—ç›¸åŠ é‡å¤ï¼Œ<s>ä¸ç®¡æ€æ ·å…ˆèƒ½è·‘å°±è¡Œ</s></p>
<pre><code>
let hexAscii = state.src.charCodeAt(pos).toString() + state.src.charCodeAt(pos + 1).toString();

if (hexAscii != 3364) { return false; }
</code>
</pre>
<p>ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼å°†<code>!@</code>å­—ç¬¦ä¸­é—´çš„å†…å®¹æå–å‡º</p>
<pre><code>
let text = state.src.substring(pos, endLine_0);
let match = text.match(/(?&lt;=!@).*(?=!@)/g);
</code>
</pre>
<p>æœ€åéœ€è¦å°†æ‰€è¦è§£æçš„æ ‡ç­¾ï¼Œæ–‡æœ¬å†…å®¹æ ¹æ®tokenæ‰€å®šä¹‰çš„å‚æ•°è¾“å…¥</p>
<pre><code>
let Tokens = state.push('codeblock_open', 'pre', 1);
Tokens.markup = '!@';
Tokens.map = [startLine, startLine + 1];

let Tokens_2 = state.push('codeblock_open_1', 'code', 1);

Tokens_2 = state.push('html_block', 'code', 0);
Tokens_2.content = match;
Tokens_2.children = [];

Tokens = state.push('html_block', 'code', 0);
Tokens.map = [startLine, startLine + 1];
Tokens.children = [];

Tokens_2 = state.push('codeblock_close_1', 'code', -1);

Tokens = state.push('codeblock_close', 'pre', -1);
Tokens.markup = '!@';
</code>
</pre>
<p>æ ¹æ®æç¤ºçš„å‚æ•°è¾“å…¥å³å¯ï¼Œä¸è¿‡ç¼–è¯‘åæˆ‘ä»¬ä¸éš¾å‘ç°ç¼–è¯‘åçš„æ–‡æœ¬ä¸­è¿˜å«æœ‰æœªç»ç¼–è¯‘çš„æ–‡æœ¬ï¼Œè€Œä¸”åªä¼šè§£æç¬¬ä¸€è¡Œï¼Œè¿™æ—¶å€™å°±éœ€è¦å°†<code>state.line</code>æ¢ä¸ºè§£æçš„æ ‡ç­¾æ‰€åœ¨è¡Œæ•°åŠ æ–‡æœ¬è¡Œæ•°åŠ 2ï¼Œå³<code>state.line = startLine + line_number + 2</code>ï¼Œæœ€åå†<code>return true</code></p>
<info>
<svgwrap>
<svgicon></svgicon>
<svgtag>
ä¿¡æ¯</svgtag>
</svgwrap>
<p>å…³äº<code>state.push</code>ä¸­typeçš„å€¼ï¼Œè¯·å‚é˜…<a href="https://github.com/markdown-it/markdown-it/blob/master/docs/examples/renderer_rules.md#default-renderer-rules" title="Default renderer rules">Default renderer rules</a>è·å–æ›´å¤šä¿¡æ¯</p>
</info>
<h3>å®Œæ•´ä»£ç </h3>
<pre><code>
md.block.ruler.before('paragraph', '!@codeblock_0', function replace(state, startLine, endLine) {
  let pos = state.bMarks[startLine] + state.tShift[startLine];
  let endLine_0 = state.eMarks[startLine];
  let hexAscii = state.src.charCodeAt(pos).toString() + state.src.charCodeAt(pos + 1).toString();

  if (hexAscii != 3364) { return false; }

  let text = state.src.substring(pos, endLine_0);
  let match = text.match(/(?&lt;=!@).*(?=!@)/g)[0];

  if (match != null) {
    let Tokens = state.push('codeblock_open', 'pre', 1);
    Tokens.markup = '!@';
    Tokens.map = [startLine, startLine + 1];

    let Tokens_2 = state.push('codeblock_open_1', 'code', 1);

    Tokens_2 = state.push('html_block', 'code', 0);
    Tokens_2.content = match;
    Tokens_2.children = [];

    Tokens = state.push('html_block', 'code', 0);
    Tokens.map = [startLine, startLine + 1];
    Tokens.children = [];

    Tokens_2 = state.push('codeblock_close_1', 'code', -1);

    Tokens = state.push('codeblock_close', 'pre', -1);
    Tokens.markup = '!@';

    state.line = startLine + 1;
    return true;
  }
});
</code>
</pre>
<p>ç»è¿‡æµ‹è¯•å¾ˆå®¹æ˜“å‘ç°ï¼Œè¿™æ ·åšå¾€å¾€åªèƒ½è§£æä¸€è¡Œï¼Œå› æ­¤å¯»æ‰¾åˆ°ç¬¦åˆè¦æ±‚çš„å•ä¸ªæ ‡ç­¾åè¿˜è¦å¾€ä¸‹ç»§ç»­å¯»æ‰¾ï¼Œæ ¹æ®å‡½æ•°ä¸­çš„å‚æ•°<code>endLine</code>å¾ˆå®¹æ˜“å°±èƒ½æƒ³åˆ°å†™ä¸€ä¸ªå¾ªç¯å»ä¸‹æ–‡åŒ¹é…ç¬¦åˆæ¡ä»¶çš„æ ‡ç­¾</p>
<h3>å®Œæ•´ä»£ç _2</h3>
<pre><code>

md.block.ruler.before('paragraph', '!@codeblock_0', function replace(state, startLine, endLine) {
  let pos = state.bMarks[startLine] + state.tShift[startLine];
  let endLine_0 = state.eMarks[startLine] + state.tShift[startLine];
  let hexAscii = state.src.charCodeAt(pos).toString() + state.src.charCodeAt(pos + 1).toString();

  if (hexAscii != 3364) { return false; }
  if (pos == (endLine_0 - 2)) {
    for (let i = 1; i &lt;= endLine; i++) {
      let pos_1 = state.bMarks[startLine + i] + state.tShift[startLine + i];
      let hexAscii_1 = state.src.charCodeAt(pos_1).toString() + state.src.charCodeAt(pos_1 + 1).toString();
      if (hexAscii_1 == 3364) {
        let text = state.src.substring(pos + 2, pos_1);

        if (text != null) {
          tokenPush(text, startLine, endLine);
          state.line = startLine + i + 1;
          return true;
        }

        break
      };
    }
  } else {

    let text = state.src.substring(pos, endLine_0);
    let match = text.match(/(?&lt;=!@).*(?=!@)/g);

    if (match != null) {
      tokenPush(match[0], startLine, endLine);
      state.line = startLine + 1;
      return true;
    }

  }

  function tokenPush(match, startLine, endLine) {
    let Tokens = state.push('codeblock_open', 'pre', 1);
    Tokens.markup = '!@';
    Tokens.map = [startLine, startLine + 1];

    let Tokens_2 = state.push('codeblock_open_1', 'code', 1);

    Tokens_2 = state.push('html_block', 'code', 0);
    Tokens_2.content = match;
    Tokens_2.children = [];

    Tokens = state.push('html_block', 'code', 0);
    Tokens.map = [startLine, startLine + 1];
    Tokens.children = [];

    Tokens_2 = state.push('codeblock_close_1', 'code', -1);

    Tokens = state.push('codeblock_close', 'pre', -1);
    Tokens.markup = '!@';
  }
});
</code>
</pre>
<p>è¿™ç¯‡æ–‡ç« çš„çš„å®Œæ•´ä»£ç _2ï¼Œå°±æ˜¯åœ¨åŸå§‹markdownæ–‡ä»¶ä¸­æ‹¿<code>!@</code>ç”Ÿæˆçš„å“¦(ï½ï¿£â–½ï¿£)ï½</p>
<p>å½“ç„¶ï¼Œé‚£ç§ç¨€å¥‡å¤æ€ªçš„å†™æ³•æ¯”å¦‚</p>
<p>!@ <br>
text!@</p>
<p>!@ text <br>
!@</p>
<p>åªèƒ½é è¯»è€…æ…¢æ…¢è§£å†³äº†</p>
</div><script src="https://giscus.app/client.js" data-repo="Yz0012/Yz0012.github.io" data-repo-id="R_kgDOPR4k8A" data-category="General" data-category-id="DIC_kwDOPR4k8M4Cx9vy" data-mapping="pathname" data-strict="0" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="dark" data-lang="zh-CN" crossorigin="anonymous" async="">
        </script></innerbody>
    </viewer>

    <body-rightsidebar id="body-rightsidebar_0" class="body-rightsidebar">
    </body-rightsidebar>
    <div id="body-sidebar-submenu-1" class="body-sidebar-submenu">
        <b>
            <div id="body-sidebar-icons-2" class="body-sidebar-icons"></div>
            <divv>æ–‡ä»¶èµ„æº</divv><br>
        </b>
    </div>
    <breadcrumb id="body-breadcrumb-1" class="body-breadcrumb">ğŸ“docs &gt; ğŸ“htmlDoc &gt; ğŸ“html_unarchived &gt;
        ğŸ“šunarchived_0000_FirstDoc.html</breadcrumb>
    <header class="header">
        <a href="/index.html">
            <img class="header-icons" src="/images/icons/icon.png" alt="icon">
        </a>
        <div id="header-m-icon_0" class="header-m-icon" onclick="clicked_0()"></div>
        
        <div id="header-m-icon-1">
            <div id="inthisarticle_0">æœ¬æ–‡å†…å®¹</div>
            <div id="inthisarticle_1" onclick="enLarge_0(this)"></div>
        </div>
    </header>


<script id="docs_m_0" src="/docs/docs_m.js" defer=""></script>
<script id="docs_m_updateWindow_0" src="/docs/docs_m_update_Window.js" defer=""></script>
<script id="docs_m_genRightbar_0" src="/docs/docs_m_genRightbar.js" defer=""></script>
<script id="highlight_0" src="/highlights/highlight.min.js"></script>
<script>hljs.highlightAll();</script>

<src style="display: none;" id="html_src_0" src_0="docs\htmlDoc\html_sitedoc\sitedoc_markdownnewrule.html"></src></body></html>